@use "sass:math";
@use "sass:meta";

@layer reset, tokens, typography, components, utilities;

@layer tokens {
  :root {
    --t-body-scale: 1;
    --t-heading-scale: 1;
    --t-font-scale-min-width: 600;
    --t-font-scale-max-width: 1440;
    --t-scale-min-w: calc(var(--t-font-scale-min-width) * 1px);
    --t-scale-max-w: calc(var(--t-font-scale-max-width) * 1px);
    --t-body-font-size-min-scale: 0.875;
    --t-body-font-size-max-scale: 1.125;
    --t-body-font-size-min: calc(var(--t-body-font-size-min-scale) * 1rem);
    --t-body-font-size-max: calc(var(--t-body-font-size-max-scale) * 1rem);
    --t-body-font-size-slope: calc(
      (var(--t-body-font-size-max) - var(--t-body-font-size-min)) * (100vw - var(--t-scale-min-w)) / (var(--t-scale-max-w) - var(--t-scale-min-w))
    );
    --t-body-font-size-clamp: clamp(
      var(--t-body-font-size-min),
      calc(var(--t-body-font-size-min) + var(--t-body-font-size-slope)),
      var(--t-body-font-size-max)
    );
    --t-heading-font-size-min-scale: 1;
    --t-heading-font-size-max-scale: 1.25;
    --t-heading-font-size-min: calc(var(--t-heading-font-size-min-scale) * 1rem);
    --t-heading-font-size-max: calc(var(--t-heading-font-size-max-scale) * 1rem);
    --t-heading-font-size-slope: calc(
      (var(--t-heading-font-size-max) - var(--t-heading-font-size-min)) * (100vw - var(--t-scale-min-w)) / (var(--t-scale-max-w) - var(--t-scale-min-w))
    );
    --t-heading-font-size-clamp: clamp(
      var(--t-heading-font-size-min),
      calc(var(--t-heading-font-size-min) + var(--t-heading-font-size-slope)),
      var(--t-heading-font-size-max)
    );
    --t-display-large: 5.7;
    --t-display-medium: 4.5;
    --t-display-small: 3.6;
    --t-headline-large: 3.2;
    --t-headline-medium: 2.8;
    --t-headline-small: 2.4;
    --t-title-large: 2.2;
    --t-title-medium: 2;
    --t-title-small: 1.8;
    --t-code-inline-bg: rgb(0 0 0 / 5%);
    --t-code-inline-color: #24292f;
    --t-code-block-bg: #f5f5f5;
    --t-code-block-color: #24292f;

    hyphens: auto;
  }

  @supports (width: 1lvw) {
    :root {
      --t-body-font-size-slope: calc(
        (var(--t-body-font-size-max) - var(--t-body-font-size-min)) * (100lvw - var(--t-scale-min-w)) / (var(--t-scale-max-w) - var(--t-scale-min-w))
      );
      --t-heading-font-size-slope: calc(
        (var(--t-heading-font-size-max) - var(--t-heading-font-size-min)) * (100lvw - var(--t-scale-min-w)) / (var(--t-scale-max-w) - var(--t-scale-min-w))
      );
      --t-body-font-size-clamp: clamp(
        var(--t-body-font-size-min),
        calc(var(--t-body-font-size-min) + var(--t-body-font-size-slope)),
        var(--t-body-font-size-max)
      );
      --t-heading-font-size-clamp: clamp(
        var(--t-heading-font-size-min),
        calc(var(--t-heading-font-size-min) + var(--t-heading-font-size-slope)),
        var(--t-heading-font-size-max)
      );
    }
  }
}

@mixin reset-last-margin() {
  &:last-of-type:not(:only-of-type) { margin-block-end: 0; }
}

@mixin typography-heading($heading-font-size) {
  $k: $heading-font-size;

  @if meta.type-of($heading-font-size) == 'number' {
    @if math.is-unitless($heading-font-size) {
      $k: $heading-font-size;
    } @else {
      $k: math.div($heading-font-size, 1em);
    }
  }

  font-size: calc(var(--t-heading-font-size-clamp) * var(--t-heading-scale, 1) * #{$k});
  line-height: var(--t-line-height-heading, 1.3);
  margin-top: 1.25lh;
  margin-bottom: 0.5lh;
  max-inline-size: var(--t-heading-measure, 50ch);
  text-wrap: balance;

  @include reset-last-margin;
}

@mixin typography-paragraph($paragraph-font-size, $paragraph-line-height, $paragraph-font-weight) {
  $k: $paragraph-font-size;

  @if not math.is-unitless($paragraph-font-size) {
    $k: math.div($paragraph-font-size, 1em);
  }

  font-size: calc(var(--t-body-font-size-clamp) * var(--t-body-scale, 1) * #{$k});
  line-height: $paragraph-line-height;
  font-weight: $paragraph-font-weight;
  margin-bottom: 0.75lh;

  @include reset-last-margin;
}

@mixin typography-list($font-size, $line-height, $margin-block) {
  $k: $font-size;

  @if not math.is-unitless($font-size) {
    $k: math.div($font-size, 1em);
  }

  font-size: calc(var(--t-body-font-size-clamp) * var(--t-body-scale, 1) * #{$k});
  line-height: $line-height;
  padding-inline-start: var(--t-list-padding-left, 2.5rem);
  margin-block: $margin-block;

  li { margin-block: 0.25lh; }
}

@mixin typography-code-inline() {
  display: inline-block;
  font-family: var(--t-monospace-font-family, ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"), monospace;
  font-size: var(--t-code-inline-font-size, 1em);
  line-height: var(--t-code-inline-line-height, 1);
  background: var(--t-code-inline-bg, rgb(0 0 0 / 5%));
  color: var(--t-code-inline-color, #24292f);
  border-radius: var(--t-code-inline-border-radius, 0.3em);
  padding: var(--t-code-inline-padding, 0.25em 0.4em);
  margin: var(--t-code-inline-margin, 0 0.25em);
  box-shadow: 0 0 0 1px var(--t-code-inline-border-color, rgb(0 0 0 / 10%));
}

@mixin typography-code-block() {
  font-family: var(--t-monospace-font-family, ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"), monospace;
  font-size: calc(var(--t-code-block-font-size, 1.4rem) * var(--t-body-scale, 1));
  line-height: var(--t-code-block-line-height, 1.6);
  background: var(--t-code-block-bg, #f5f5f5);
  color: var(--t-code-block-color, #24292f);
  margin: var(--t-code-block-margin, 1.3em 0);
  border-radius: var(--t-code-block-border-radius, 0.6rem);
  overflow-x: auto;
  white-space: pre;
  max-inline-size: 100%;
}

@layer reset {
  html {
    font-size: 100%;
    text-size-adjust: 100%;
    box-sizing: border-box;
  }

  @supports (text-wrap: pretty) {
    :root { text-wrap: pretty; }
  }

  *,
  *::before,
  *::after { box-sizing: inherit; }

  a { text-decoration-skip-ink: auto; }

  ul,
  ol { list-style-position: outside; }

  ul { list-style-type: disc; }
  ol { list-style-type: decimal; }

  input,
  button,
  select,
  textarea {
    font: inherit;
    line-height: inherit;
  }
}

@layer typography {
  body {
    font-family: var(--t-base-font-family, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif);
    font-size: calc(var(--t-body-font-size-clamp) * var(--t-body-scale, 1));
    line-height: var(--t-line-height-body, 1.5);
    font-weight: 400;
    font-optical-sizing: auto;
    font-kerning: normal;
    font-variant-ligatures: common-ligatures contextual;
    font-variant-numeric: proportional-nums;
    font-synthesis-weight: none;
    font-synthesis-style: none;
  }

  .display {
    &-large { @include typography-heading(var(--t-display-large)); }
    &-medium { @include typography-heading(var(--t-display-medium)); }
    &-small { @include typography-heading(var(--t-display-small)); }
  }

  .headline {
    &-large { @include typography-heading(var(--t-headline-large)); }
    &-medium { @include typography-heading(var(--t-headline-medium)); }
    &-small { @include typography-heading(var(--t-headline-small)); }
  }

  .title {
    &-large { @include typography-heading(var(--t-title-large)); }
    &-medium { @include typography-heading(var(--t-title-medium)); }
    &-small { @include typography-heading(var(--t-title-small)); }
  }

  .label {
    &-large { @include typography-paragraph(1em, 1.3, 600); }
    &-medium { @include typography-paragraph(0.9em, 1.35, 600); }
    &-small { @include typography-paragraph(0.85em, 1.2, 600); }
  }

  .body {
    &-large { @include typography-paragraph(1em, 1.5, 400); }
    &-medium { @include typography-paragraph(0.9em, 1.45, 400); }
    &-small { @include typography-paragraph(0.85em, 1.35, 400); }
  }

  ul.list,
  ol.list {
    &-large { @include typography-list(1em, 1.5, 0.75lh 0.75lh); }
    &-medium { @include typography-list(0.9em, 1.45, 0.5lh 0.75lh); }
    &-small { @include typography-list(0.85em, 1.35, 0.5lh 0.5lh); }
  }

  code:not(pre code) { @include typography-code-inline; }

  code { overflow-wrap: anywhere; }

  pre,
  code {
    tab-size: 2;
    font-variant-ligatures: none;
    font-variant-numeric: tabular-nums slashed-zero;
  }

  pre {
    @include typography-code-block;

    code {
      display: inline-block;
      padding: var(--t-code-block-padding, 1.2rem 2rem);
    }
  }

  :where(h1, .display-large) { @include typography-heading(var(--t-display-large)); }
  :where(h2, .headline-large) { @include typography-heading(var(--t-headline-large)); }
  :where(h3, .headline-medium) { @include typography-heading(var(--t-headline-medium)); }
  :where(h4, .headline-small) { @include typography-heading(var(--t-headline-small)); }
  :where(h5, .title-medium) { @include typography-heading(var(--t-title-medium)); }
  :where(h6, .title-small) { @include typography-heading(var(--t-title-small)); }

  @supports (hanging-punctuation: first) {
    h1,
    h2,
    h3 { hanging-punctuation: first allow-end; }
  }

  :where(p, .body-medium) {
    @include typography-paragraph(1em, 1.45, 400);

    hyphens: auto;
  }

  .label-large,
  .label-medium,
  .label-small {
    font-variant-numeric: tabular-nums slashed-zero;
  }
}
